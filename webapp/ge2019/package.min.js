function SVG(t,e,i){if(!t)return this;this.version="0.1.6",this.canvas=S("#"+t),this.w=parseInt(e||this.canvas[0].offsetWidth),this.h=parseInt(i||this.canvas[0].offsetHeight),this.id=t,this.canvas.html('<svg height="'+this.h+'" version="1.1" width="'+this.w+'" viewBox="0 0 '+this.w+" "+this.h+'" xmlns="http://www.w3.org/2000/svg"><desc>Created by stuQuery SVG</desc></svg>'),this.paper=S(this.canvas.find("svg")[0]),this.nodes=[],this.clippaths=[],this.patterns=[];var s=this,r=0;function h(t){if(this.path=t,"string"==typeof(this.p=t)){var e;this.path=t,this.p=t,this.p+="0",this.p=this.p.match(/(^|[A-Za-z]| )[^ A-Za-z]+/g);var i=this.p[this.p.length-1];this.p[this.p.length-1]=i.substring(0,i.length-1);for(var s=0;s<this.p.length;s++)if(0==this.p[s].search(/[A-Za-z]/)?(e=this.p[s][0],this.p[s]=this.p[s].substr(1)):(" "==this.p[s][0]&&(this.p[s]=this.p[s].substr(1)),e=""),this.p[s]=[e,this.p[s].split(/\,/)],2==this.p[s][1].length)for(var r=0;r<this.p[s][1].length;r++)this.p[s][1][r]=parseFloat(this.p[s][1][r]);else this.p[s][1]=[]}else this.p=t,this.path=this.string(t);return this}function n(t){var e;for(e in this.transforms=[],this.orig={},this.events=[],t)t[e]&&(this[e]=t[e]);for(e in t)t[e]&&(this.orig[e]=t[e]);return this.path&&(this.path=new h(this.path),this.d=this.path.string(),this.orig.path=this.path.copy(),this.orig.d=this.d),this.id=s.id+"-svg-node-"+r,r++,this}return h.prototype.string=function(){for(var t="",e=0;e<this.p.length;e++)t+=(this.p[e][0]?this.p[e][0]:" ")+(0<this.p[e][1].length?this.p[e][1].join(","):" ");return t},h.prototype.copy=function(){return new h(function t(e){var i,s,r;for(r in i=Array.isArray(e)?[]:{},e)e[r]&&(s=e[r],i[r]="object"==typeof s?t(s):s);return i}(this.p))},n.prototype.on=function(t,e,i){return i||"function"!=typeof e||(i=e,e={}),this.events.push({type:t,attr:e,fn:i}),this},n.prototype.attr=function(t,e){for(var i in e&&((t={})[t]=e),this.attributes||(this.attributes={}),this.el&&0!=this.el.length||(this.el=S("#"+this.id)),t)if(t[i]&&("string"==typeof t[i]&&(t[i]=t[i].replace(/\"/g,"'")),this.attributes[i]=t[i],this.el.attr(i,t[i]),"path"==i&&this.el.attr("d",new h(t[i]).string()),"text"==this.type))for(var s=this.el.find("tspan"),r=0;r<s.length;r++)s[r].setAttribute("x",this.attributes.x||this.x);return this.orig.attributes=JSON.parse(JSON.stringify(this.attributes)),this.attributes&&this.attributes.id&&(this.id=this.attributes.id),this},n.prototype.transform=function(t){void 0===t.length&&"object"==typeof t&&(t=[t]),this.transforms||(this.transforms=[]);for(var e=0;e<t.length;e++)this.transforms.push(t[e]);return this},n.prototype.update=function(){if(this.transforms&&0<this.transforms.length){var t,e,i,s;for(this.orig.path&&(this.path=this.orig.path.copy()),t=0;t<this.transforms.length;t++)for(e in this.transforms[t].props)this.orig[e]&&this[e]&&(this[e]=JSON.parse(JSON.stringify(this.orig[e])));for(this.orig.attributes&&(this.attributes=JSON.parse(JSON.stringify(this.orig.attributes))),t=0;t<this.transforms.length;t++)if("scale"==this.transforms[t].type){if("path"==this.type){for(i=0;i<this.orig.path.p.length;i++)for(s=0;s<this.orig.path.p[i][1].length;s++)this.path.p[i][1][s]*=this.transforms[t].props[s%2==0?"x":"y"];this.path.path=this.path.string(),this.d=this.path.path}else for(e in this.transforms[t].props)this[e]&&(this[e]*=this.transforms[t].props[e]);if(this.attributes)for(e in this.transforms[t].props)this.attributes[e]&&(this.attributes[e]*=this.transforms[t].props[e])}}return this},this.circle=function(t,e,i){return this.nodes.push(new n({cx:t,cy:e,r:i,type:"circle"})),this.nodes[this.nodes.length-1]},this.rect=function(t,e,i,s,r){return r?this.nodes.push(new n({x:t,y:e,width:i,height:s,r:r,rx:r,ry:r,type:"rect"})):this.nodes.push(new n({x:t,y:e,width:i,height:s,type:"rect"})),this.nodes[this.nodes.length-1]},this.path=function(t){return this.nodes.push(new n({path:t,type:"path"})),this.nodes[this.nodes.length-1]},this.text=function(t,e,i){return this.nodes.push(new n({x:t,y:e,type:"text",text:i})),this.nodes[this.nodes.length-1]},this.clip=function(t){return this.clippaths.push(new n(t)),this.clippaths[this.clippaths.length-1]},this.pattern=function(t){return this.patterns.push(t),this.patterns[this.patterns.length-1]},this}function HexMap(t){if(this.version="0.4",t=t||{},this._attr=t,0==S("#"+t.id).length)return console.log("Can't find the element to draw into (#"+t.id+")"),{};this.w=t.width||300,this.h=t.height||150,this.maxw=this.w,this.maxh=this.h,this.s=t.size||10,this.aspectratio=this.w/this.h,this.id=t.id,this.hexes={},this.min=0,this.max=1,this.padding="number"==typeof t.padding?t.padding:0,this.properties={size:"number"==typeof t.size?t.size:10};var e=.4*("number"==typeof t.size?t.size:10);for(var i in 0==S("#"+this.id+"-inner").length&&S("#"+this.id).append('<div id="'+this.id+'-inner"></div>'),this.el=S("#"+this.id+"-inner"),this.options={showgrid:"boolean"==typeof t.grid&&t.grid,showlabel:"boolean"!=typeof t.showlabel||t.showlabel,formatLabel:"function"==typeof t.formatLabel?t.formatLabel:function(t,e){return t.substr(0,3)},minFontSize:"number"==typeof t.minFontSize?t.minFontSize:4},this.style={default:{fill:"#cccccc","fill-opacity":this.options.showlabel?.5:1,"font-size":e,"stroke-width":1.5,"stroke-opacity":1,stroke:"#ffffff"},highlight:{fill:"#1DD3A7"},grid:{fill:"#aaa","fill-opacity":.1}},t.style)t.style[i]&&(this.style[i]||(this.style[i]={}),t.style[i].fill&&(this.style[i].fill=t.style[i].fill),t.style[i]["fill-opacity"]&&(this.style[i]["fill-opacity"]=t.style[i]["fill-opacity"]),t.style[i]["font-size"]&&(this.style[i]["font-size"]=t.style[i]["font-size"]),t.style[i].stroke&&(this.style[i].stroke=t.style[i].stroke),t.style[i]["stroke-width"]&&(this.style[i]["stroke-width"]=t.style[i]["stroke-width"]),t.style[i]["stroke-opacity"]&&(this.style[i]["stroke-opacity"]=t.style[i]["stroke-opacity"]));this.mapping={},this.load=function(t,e,i){return"function"!=typeof e||i||(i=e,e=""),"function"!=typeof i||("string"==typeof t?S(document).ajax(t,{complete:function(t){this.setMapping(t),"function"==typeof i&&i.call(this,{data:e})},error:this.failLoad,this:this,dataType:"json"}):"object"==typeof t&&(this.setMapping(t),"function"==typeof i&&i.call(this,{data:e}))),this};var p=this;return window.addEventListener("resize",function(t){p.resize()}),this.setHexStyle=function(t){var e,i=this.hexes[t],s=(e=this.style.default,JSON.parse(JSON.stringify(e))),r="";if(i.active&&(s.fill=i.fillcolour),i.hover&&(r+=" hover"),i.selected){for(var h in this.style.selected)this.style.selected[h]&&(s[h]=this.style.selected[h]);r+=" selected"}return this.search.active&&(r+=i.highlight?" highlighted":" not-highlighted"),s.class="hex-cell"+r,i.attr(s),this.labels[t].attr({class:"hex-label"+r}),i},this.toFront=function(t){for(var e in this.hexes)this.hexes[e].selected&&(this.paper.paper[0].appendChild(this.hexes[e].el[0]),this.paper.paper[0].appendChild(this.labels[e].el[0]));return this.paper.paper[0].appendChild(this.hexes[t].el[0]),this.paper.paper[0].appendChild(this.labels[t].el[0]),this},this.regionToggleSelected=function(t,e){this.selected=this.selected==t?"":t;var i,s=this.hexes[t];if(s.selected=!s.selected,this.setHexStyle(t),!s.selected&&e)for(i in this.hexes)this.hexes[i].selected&&(this.hexes[i].selected=!1,this.setHexStyle(i));return this},this.regionFocus=function(t){return this.hexes[t].hover=!0,this.setHexStyle(t),this.toFront(t),this},this.regionBlur=function(t){return this.hexes[t].hover=!1,this.setHexStyle(t),this},this.regionActivate=function(t){this.hexes[t].active=!0,this.setHexStyle(t)},this.regionDeactivate=function(t){this.hexes[t].active=!1,this.setHexStyle(t)},this.regionToggleActive=function(t){var e=this.hexes[t];e.active=!e.active,this.setHexStyle(t)},this.selectRegion=function(t){var e;for(var i in this.selected=t,this.hexes)this.hexes[i]&&(e=this.hexes[i],0<t.length&&0==i.indexOf(t)?e.selected=!0:e.selected=!1,this.setHexStyle(i));return this},this.on=function(t,e,i){return"function"!=typeof e||i||(i=e,e=""),"function"!=typeof i||(this.callback||(this.callback={}),this.callback[t]={fn:i,attr:e}),this},this.moveTo=function(t,e){if(this.selected){var i=t-this.mapping.hexes[this.selected].q,s=e-this.mapping.hexes[this.selected].r;for(var r in this.hexes)if(this.hexes[r]&&(0==r.indexOf(this.selected)&&(this.hexes[r].selected=!0),this.hexes[r].selected)){this.mapping.hexes[r].q+=i,this.mapping.hexes[r].r+=s;var h=this.drawHex(this.mapping.hexes[r].q,this.mapping.hexes[r].r);this.hexes[r].attr({path:h.path}).update(),this.options.showlabel&&this.labels[r]&&this.labels[r].attr({x:h.x,y:h.y+this.style.default["font-size"]/2,"clip-path":"hex-clip-"+this.mapping.hexes[r].q+"-"+this.mapping.hexes[r].r}).update(),this.hexes[r].selected=!1,this.setHexStyle(r)}this.selected=""}},this.size=function(t,e){this.el.css({height:"",width:""}),t=Math.min(this.w,S("#"+this.id)[0].offsetWidth),this.el.css({height:t/this.aspectratio+"px",width:t+"px"}),this.paper=new SVG(this.id+"-inner",this.maxw,this.maxh),t=this.paper.w,e=this.paper.h;var i=t/this.w;return this.properties.size=this.s*i,this.w=t,this.h=e,this.transform={type:"scale",props:{x:t,y:e,cx:t,cy:e,r:t,"stroke-width":t}},this.el.css({height:"",width:""}),this},this.resize=function(){return this},this.initialized=function(){return this.create().draw(),S(".spinner").remove(),this},this.create=function(){return this.paper.clear(),this.constructed=!1,this},this.setMapping=function(t){this.mapping=t,this.properties||(this.properties={x:100,y:100}),this.properties.x=this.w/2,this.properties.y=this.h/2,this.setSize();var e=t.layout.split("-");return this.properties.shift=e[0],this.properties.orientation=e[1],this.initialized()},this.setSize=function(t){return t&&(this.properties.size=t),this.properties.s={cos:this.properties.size*Math.sqrt(3)/2,sin:.5*this.properties.size},this.properties.s.c=this.properties.s.cos.toFixed(2),this.properties.s.s=this.properties.s.sin.toFixed(2),this},this.drawHex=function(t,e,i){if(this.properties){"number"!=typeof i&&(i=1),i=Math.sqrt(i);var s=this.properties.x+t*this.properties.s.cos*2,r=this.properties.y-e*this.properties.s.sin*3;"r"==this.properties.orientation&&("odd"==this.properties.shift&&1==(1&e)&&(s+=this.properties.s.cos),"even"==this.properties.shift&&0==(1&e)&&(s+=this.properties.s.cos)),"q"==this.properties.orientation&&("odd"==this.properties.shift&&1==(1&t)&&(r+=this.properties.s.cos),"even"==this.properties.shift&&0==(1&t)&&(r+=this.properties.s.cos));var h=[["M",[s,r]]],n=this.properties.s.c*i,a=this.properties.s.s*i;return"r"==this.properties.orientation?(h.push(["m",[n,-a]]),h.push(["l",[-n,-a,-n,a,0,(this.properties.size*i).toFixed(2),n,a,n,-a]])):(h.push(["m",[-a,n]]),h.push(["l",[-a,-n,a,n,(this.properties.size*i).toFixed(2),0,a,n,-a,n]])),h.push(["z",[]]),{path:h,x:s,y:r}}return this},this.updateColours=function(){var t="function"==typeof this.setColours?this.setColours:function(){return this.style.default.fill};for(var e in this.mapping.hexes)this.mapping.hexes[e]&&(this.hexes[e].fillcolour=t.call(this,e),this.setHexStyle(e));return this},this.draw=function(){var t,e,i,s,r={r:{min:1e100,max:-1e100},q:{min:1e100,max:-1e100}};for(s in this.mapping.hexes)this.mapping.hexes[s]&&(e=this.mapping.hexes[s].q,t=this.mapping.hexes[s].r,e>r.q.max&&(r.q.max=e),e<r.q.min&&(r.q.min=e),t>r.r.max&&(r.r.max=t),t<r.r.min&&(r.r.min=t));r.q.min-=this.padding,r.q.max+=this.padding,r.r.min-=this.padding,r.r.max+=this.padding;var h=(r.q.max+r.q.min)/2,n=(r.r.max+r.r.min)/2;this.properties.x=this.w/2-2*this.properties.s.cos*h,this.properties.y=this.h/2+3*this.properties.s.sin*n,this.range=r;var a=function(t){var e="mouseover";if(t.data.hexmap.callback[e]){for(var i in t.data.hexmap.callback[e].attr)t.data.hexmap.callback[e].attr[i]&&(t.data[i]=t.data.hexmap.callback[e].attr[i]);if("function"==typeof t.data.hexmap.callback[e].fn)return t.data.hexmap.callback[e].fn.call(this,t)}},o=function(t){var e="mouseout";if(t.data.hexmap.callback[e]){for(var i in t.data.hexmap.callback[e].attr)t.data.hexmap.callback[e].attr[i]&&(t.data[i]=t.data.hexmap.callback[e].attr[i]);if("function"==typeof t.data.hexmap.callback[e].fn)return t.data.hexmap.callback[e].fn.call(this,t)}},l=function(t){var e="click";if(t.data.hexmap.callback[e]){for(var i in t.data.hexmap.callback[e].attr)t.data.hexmap.callback[e].attr[i]&&(t.data[i]=t.data.hexmap.callback[e].attr[i]);if("function"==typeof t.data.hexmap.callback[e].fn)return t.data.hexmap.callback[e].fn.call(this,t)}};if(this.options.showgrid)for(this.grid=[],e=r.q.min;e<=r.q.max;e++)for(t=r.r.min;t<=r.r.max;t++)i=this.drawHex(e,t),this.grid.push(this.paper.path(i.path).attr({class:"hex-grid","data-q":e,"data-r":t,fill:this.style.grid.fill||"","fill-opacity":this.style.grid["fill-opacity"]||.1,stroke:this.style.grid.stroke||"#aaa","stroke-opacity":this.style.grid["stroke-opacity"]||.2})),this.grid[this.grid.length-1].on("mouseover",{type:"grid",hexmap:this,data:{r:t,q:e}},a).on("mouseout",{type:"grid",hexmap:this,me:p,data:{r:t,q:e}},o).on("click",{type:"grid",hexmap:this,region:s,me:p,data:{r:t,q:e}},l),this.paper.clip({path:i.path,type:"path"}).attr({id:"hex-clip-"+e+"-"+t});for(s in this.values={},this.mapping.hexes)this.mapping.hexes[s]&&(this.values[s]=(this.mapping.hexes[s].p-5e4)/3e4,this.values[s].value<0&&(this.values[s]=0),1<this.values[s].value&&(this.values[s]=1),i=this.drawHex(this.mapping.hexes[s].q,this.mapping.hexes[s].r),this.constructed||(this.hexes[s]=this.paper.path(i.path).attr({class:"hex-cell","data-q":this.mapping.hexes[s].q,"data-r":this.mapping.hexes[s].r}),this.hexes[s].selected=!1,this.hexes[s].active=!0,this.hexes[s].attr({id:"hex-"+s}),this.hexes[s].on("mouseover",{type:"hex",hexmap:this,region:s,data:this.mapping.hexes[s],pop:this.mapping.hexes[s].p},a).on("mouseout",{type:"hex",hexmap:this,region:s,me:this.hexes[s]},o).on("click",{type:"hex",hexmap:this,region:s,me:this.hexes[s],data:this.mapping.hexes[s]},l),this.options.showlabel&&(this.labels||(this.labels={}),this.style.default["font-size"]>this.options.minFontSize&&(this.labels[s]=this.paper.text(i.x,i.y+this.style.default["font-size"]/2,this.options.formatLabel(this.mapping.hexes[s].n,{size:this.properties.size,"font-size":this.style.default["font-size"]})).attr({"clip-path":"hex-clip-"+this.mapping.hexes[s].q+"-"+this.mapping.hexes[s].r,"data-q":this.mapping.hexes[s].q,"data-r":this.mapping.hexes[s].r,class:"hex-label","text-anchor":"middle","font-size":this.style.default["font-size"]+"px",title:this.mapping.hexes[s].n||s}),this.labels[s].attr({id:"hex-"+s+"-label"}))),this.labels[s].on("mouseover",{type:"hex",hexmap:this,region:s,data:this.mapping.hexes[s],pop:this.mapping.hexes[s].p},a).on("mouseout",{type:"hex",hexmap:this,region:s,me:this.labels[s]},o).on("click",{type:"hex",hexmap:this,region:s,me:this.labels[s],data:this.mapping.hexes[s]},l)),this.setHexStyle(s),this.hexes[s].attr({stroke:this.style.default.stroke,"stroke-opacity":this.style.default["stroke-opacity"],"stroke-width":this.style.default["stroke-width"],title:this.mapping.hexes[s].n,"data-regions":s,style:"cursor: pointer;"}),this.hexes[s].update());return this.constructed||this.paper.draw(),this.constructed=!0,this},S(document).on("keypress",{me:this},function(t){t.stopPropagation(),99==t.originalEvent.charCode&&t.data.me.selectBySameColour(t)}),this.selectBySameColour=function(){if(this.selected)for(var t in this.hexes)this.hexes[t].fillcolour==this.hexes[this.selected].fillcolour&&(this.hexes[t].selected=!0,this.setHexStyle(t));return this},this.size(),t.file&&this.load(t.file),this.search=new function(t){return t=t||{},this.attr=t,this.el="",this.active=!1,this.selected=-1,this.init=function(){this.attr.id&&(this.el=S("#"+this.attr.id)),0==this.el.length&&(S("#"+hexmap.id).append('<div class="hex-search"></div>'),this.el=S("#"+p.id+" .hex-search")),0==this.el.find(".search-input").length&&this.el.append('<input type="text" class="search-input" name="constituencies" id="constituencies" value="">'),0==this.el.find(".search-button").length&&this.el.append('<button class="search-button"></button>'),this.el.find(".search-button").on("click",{hexmap:p,me:this},function(t){t.data.me.selected=-1,t.data.me.toggle()}),this.el.find(".search-input").on("keyup",{hexmap:p,me:this},function(t){var e=t.currentTarget.value.toLowerCase(),i={},s="",r=0;if(1<e.length)for(var h in t.data.hexmap.hexes)0<=t.data.hexmap.hexes[h].attributes.title.toLowerCase().indexOf(e)&&(i[h]=!0,r<8&&(s+='<li><a href="#" data="'+h+'">'+t.data.hexmap.hexes[h].attributes.title+"</a></li>",r++));40==t.originalEvent.keyCode||38==t.originalEvent.keyCode?(40==t.originalEvent.keyCode&&t.data.me.selected++,38==t.originalEvent.keyCode&&t.data.me.selected--,r=t.data.me.el.find(".search-results a").length,t.data.me.selected<0&&(t.data.me.selected=0),t.data.me.selected>=r&&(t.data.me.selected=r-1),t.data.me.el.find(".search-results a").removeClass("selected"),S(t.data.me.el.find(".search-results a")[t.data.me.selected]).addClass("selected")):13==t.originalEvent.keyCode?t.data.me.el.find(".search-results a.selected").trigger("click"):(0==t.data.me.el.find(".search-results").length&&t.data.me.el.find(".search-input").after('<ul class="search-results">BLAH</ul>'),t.data.me.el.find(".search-results").html(s),t.data.me.el.find(".search-results a").on("click",{me:t.data.me,builder:t.data.hexmap},function(t){t.preventDefault(),t.stopPropagation(),t.data.builder.hexes[t.currentTarget.getAttribute("data")].el.trigger("click"),t.data.me.el.find(".search-results").remove()}),t.data.me.highlight(i))})},this.toggle=function(){if(this.active=!this.active,this.active){this.el.addClass("searching"),this.el.find(".search-input")[0].focus();var t=this.el.find(".search-input")[0].value;this.el.find(".search-input")[0].value="",this.el.find(".search-input")[0].value=t,this.el.find(".search-input")[0].value&&this.el.find(".search-input").trigger("keyup")}else this.el.removeClass("searching"),this.highlight({}),this.el.find(".search-results").remove()},this.highlight=function(t){var e;for(e in this.n=0,t)t[e]&&this.n++;for(e in p.hexes)0<this.n?t[e]?(p.hexes[e].highlight=!0,p.hexes[e].attr({class:"hex-cell highlighted"})):(p.hexes[e].highlight=!1,p.hexes[e].attr({class:"hex-cell not-highlighted"})):(p.hexes[e].highlight=!1,p.hexes[e].attr({class:"hex-cell"}));return this},this.init(),this}(t.search),this}function Colour(t,e){if(!t)return{};function i(t){return(t<16?"0":"")+t.toString(16)}function s(t){return parseInt(t,16)}if(this.alpha=1,0==t.indexOf("#"))this.hex=t,this.rgb=[s(t.substring(1,3)),s(t.substring(3,5)),s(t.substring(5,7))];else{if(0!=t.indexOf("rgb"))return{};var r=t.match(/[0-9\.]+/g);4==r.length&&(this.alpha=parseFloat(r[3])),this.rgb=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2])],this.hex="#"+i(this.rgb[0])+i(this.rgb[1])+i(this.rgb[2])}var h,n;for(this.hsv=function(t,e,i){t/=255,e/=255,i/=255;var s,r,h=Math.max(t,e,i),n=Math.min(t,e,i),a=h,o=h-n;if(r=0==h?0:o/h,h==n)s=0;else{switch(h){case t:s=(e-i)/o+(e<i?6:0);break;case e:s=(i-t)/o+2;break;case i:s=(t-e)/o+4}s/=6}return[s,r,a]}(this.rgb[0],this.rgb[1],this.rgb[2]),this.name=e||"Name",n=h=0;h<this.rgb.length;h++)200<this.rgb[h]&&n++;return this.text=500<this.rgb[0]+this.rgb[1]+this.rgb[2]||1<n?"black":"white",this}function ResultsMap(id,attr){if(attr=attr||{},attr.padding||(attr.padding=0),!(attr.width&&attr.height&&attr.file&&attr.views))return{};this.w=attr.width,this.h=attr.height,this.aspectratio=attr.width/attr.height,this.id=id,this.type="",this.files={},this.views=attr.views,this.cache={},0<S("#data-selector").length&&(this.type=S("#data-selector")[0].value),0<S(".view-toggle").length&&(this.type=document.querySelector('input[name="view"]:checked').id),this.defaulttype=this.type;var t=location.search.replace(/\?/,"");if(t){var options=S("#data-selector option"),v,i,ok;if(0<options.length){for(ok=!1,v="",i=0;i<options.length;i++)options[i].getAttribute("value")==t&&(ok=!0);ok&&(S("#data-selector")[0].value=t,this.type=t)}else if(options=S(".view-toggle"),0<options.length)for(v="",i=0;i<options.length;i++)options[i].getAttribute("id")==t&&(options[i].checked=!0,this.type=t)}var attrhex=JSON.parse(JSON.stringify(attr));attrhex.id=id,attrhex.size=16,this.hex=new HexMap(attrhex),this.pushstate=!(!window.history||!history.pushState);var _obj=this;function getTimestamp(t){var i,e="";return t.replace(/last-modified: (.*)/,function(t,e){i=e}),i&&(e=((i=new Date(i)).getUTCHours()<10?"0":"")+i.getUTCHours()+":"+(i.getUTCMinutes()<10?"0":"")+i.getUTCMinutes()),e}function CSV2JSON(data,format,start,end){"number"!=typeof start&&(start=1);var lines=CSVToArray(data);"number"!=typeof end&&(end=lines.length);var header=lines[0],simpleheader=JSON.parse(JSON.stringify(header)),line,datum,key,key2,f,i,newdata=[],lookup={};if(format){for(i in format)format[i]&&(key=i.replace(/ /g,"").toLowerCase(),lookup[key]=i+"");for(i=0;i<simpleheader.length;i++)simpleheader[i]=simpleheader[i].replace(/ /g,"").toLowerCase()}for(i=start;i<end;i++)if(line=lines[i],datum={},line){for(var j=0;j<line.length;j++)if(key=header[j],key2=simpleheader[j],format&&lookup[key2])if(key=lookup[key2],f=format[key],format[key].name&&(key=format[key].name),"number"==f.format)""!=line[j]&&("infinity"==line[j]||"Inf"==line[j]?datum[key]=Number.POSITIVE_INFINITY:datum[key]=parseFloat(line[j]));else if("eval"==f.format)""!=line[j]&&(datum[key]=eval(line[j]));else if("date"==f.format)if(line[j]){line[j]=line[j].replace(/^"/,"").replace(/"$/,"");try{datum[key]=new Date(line[j])}catch(t){this.log.warning("Invalid date "+line[j]),datum[key]=new Date("0001-01-01")}}else datum[key]=null;else"boolean"==f.format?"1"==line[j]||"true"==line[j]||"Y"==line[j]?datum[key]=!0:"0"==line[j]||"false"==line[j]||"N"==line[j]?datum[key]=!1:datum[key]=null:datum[key]='"'==line[j][0]&&'"'==line[j][line[j].length-1]?line[j].substring(1,line[j].length-1):line[j];else datum[key]='"'==line[j][0]&&'"'==line[j][line[j].length-1]?line[j].substring(1,line[j].length-1):line[j];newdata.push(datum)}return newdata}function CSVToArray(t,e){e=e||",";for(var i=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),s=[[]],r=!1;r=i.exec(t);){var h,n=r[1];n.length&&n!==e&&s.push([]),h=r[2]?r[2].replace(new RegExp('""',"g"),'"'):r[3],s[s.length-1].push(h)}return s}function d2h(t){return(t<16?"0":"")+t.toString(16)}function h2d(t){return parseInt(t,16)}function Colour(t,e){if(!t)return{};if(this.alpha=1,0==t.indexOf("#"))this.hex=t,this.rgb=[h2d(t.substring(1,3)),h2d(t.substring(3,5)),h2d(t.substring(5,7))];else{if(0!=t.indexOf("rgb"))return{};var i=t.match(/[0-9\.]+/g);4==i.length&&(this.alpha=parseFloat(i[3])),this.rgb=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2])],this.hex="#"+d2h(this.rgb[0])+d2h(this.rgb[1])+d2h(this.rgb[2])}var s,r;for(this.hsv=function(t,e,i){t/=255,e/=255,i/=255;var s,r,h=Math.max(t,e,i),n=Math.min(t,e,i),a=h,o=h-n;if(r=0==h?0:o/h,h==n)s=0;else{switch(h){case t:s=(e-i)/o+(e<i?6:0);break;case e:s=(i-t)/o+2;break;case i:s=(t-e)/o+4}s/=6}return[s,r,a]}(this.rgb[0],this.rgb[1],this.rgb[2]),this.name=e||"Name",r=s=0;s<this.rgb.length;s++)200<this.rgb[s]&&r++;return this.text=500<this.rgb[0]+this.rgb[1]+this.rgb[2]||1<r?"black":"white",this}function getColour(t,e,i){return i=i||e,"rgb("+parseInt(e.rgb[0]+(i.rgb[0]-e.rgb[0])*t)+","+parseInt(e.rgb[1]+(i.rgb[1]-e.rgb[1])*t)+","+parseInt(e.rgb[2]+(i.rgb[2]-e.rgb[2])*t)+")"}function makeGradient(t,e){return e=e||t,"background: "+t.hex+"; background: -moz-linear-gradient(left, "+t.hex+" 0%, "+e.hex+" 100%);background: -webkit-linear-gradient(left, "+t.hex+" 0%,"+e.hex+" 100%);background: linear-gradient(to right, "+t.hex+" 0%,"+e.hex+" 100%);"}function setTextColor(t){if(!t)return"";var e=getL(t=new Colour(t).hex),i=getL("#000000"),s=getL("#ffffff"),r=(Math.max(e,i)+.05)/(Math.min(e,i)+.05),h=(Math.max(e,s)+.05)/(Math.min(e,s)+.05);return e==s?"#000000":h<r?"#000000":"#FFFFFF"}function getL(t){return.2126*getsRGB(t.substr(1,2))+.7152*getsRGB(t.substr(3,2))+.0722*getsRGB(t.substr(-2))}function getRGB(e){try{e=parseInt(e,16)}catch(t){e=!1}return e}function getsRGB(t){return t=(t=getRGB(t)/255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}return this.pushstate&&(window[this.pushstate?"onpopstate":"onhashchange"]=function(t){t.state&&t.state.type?_obj.updateData(t.state.type):_obj.updateData(_obj.defaulttype)}),this.hex.load(attr.file,{me:this},function(t){t.data.me.setType(t.data.me.type,t.data.me.type!=t.data.me.defaulttype)}),window.addEventListener("message",function(t){_obj.iframe=t.data,_obj.positionBubble()},!1),this.positionBubble=function(){this.iframe&&0<S(".infobubble").length&&S(".infobubble").css({top:"calc("+(0<this.iframe.top?this.iframe.top:0)+"px + 1em)","max-height":this.iframe.height+"px"})},this.setType=function(t,e){return t==this.by?console.log("no change"):(this.pushstate&&history.pushState({type:t},"Hexes",e?"?"+t:""),this.updateData(t)),this},this.startPolling=function(t){this.views[t].live?(console.info("Start loop for "+t),(_obj=this).polling=window.setInterval(function(){_obj.loadResults(t,function(t){this.setColours(t)})},6e4)):this.polling&&(console.info("Stop loop"),clearInterval(this.polling))},this.updateData=function(t){return this.polling&&(console.info("Stop loop"),clearInterval(this.polling)),this.data&&this.data[t]?(this.setColours(t),this.views[t].live&&this.startPolling(t),this):this.loadResults(t,function(t){this.setColours(t),this.views[t].live&&this.startPolling(t)})},this.hex.on("mouseover",{builder:this},function(t){t.data.hexmap.regionFocus(t.data.region),0==S("#tooltip").length&&S("#"+t.data.builder.id+"-inner").append('<div id="tooltip"></div>');var e=S("#tooltip");e.html(t.data.builder.hex.hexes[t.data.region].attributes.title+"</div>");var i=t.data.builder.hex.hexes[t.data.region].el[0].getBoundingClientRect();e.css({position:"absolute",left:Math.round(i.left+i.width/2-S("#"+t.data.builder.id)[0].offsetLeft)+"px",top:Math.round(i.y+i.height+window.scrollY-S("#"+t.data.builder.id)[0].offsetTop)+"px"})}).on("mouseout",{builder:this},function(t){t.data.hexmap.regionBlur(t.data.region),S("#tooltip").remove()}).on("click",{builder:this},function(t){t.data.builder.openActive(t.data.region)}),this.closeActive=function(){return this.hex.selected="",this.hex.selectRegion(""),S(".infobubble").remove(),S("body").removeClass("modal"),this},this.openActive=function(t){var e=this.hex.selected,i=t;return this.hex.search.active&&this.hex.search.toggle(),this.label(t,e!=i),this.hex.selectRegion(t),this},this.label=function(t,e){var i=this.views[this.by];if(!i)return this;var l=i.popup,s=this.hex.hexes[t].el[0].getAttribute("title");function r(t,e,i,s){var r=getTimestamp(s.header);if(this.cache[e]==r&&0==S(".infobubble_inner .spinner").length)return console.info("Constituency results unchanged since "+r),this;this.cache[e]=r,s.timestamp=r;var h={},n=(h=l&&"function"==typeof l.render?l.render.call(this,t,e,i,s):(console.warn("No view for "+this.by),{label:t,class:cls,color:""})).color||"",a=h.color?setTextColor(n):"black",o=h.label;return o=o.replace(/%COLOR%/g,a),S(".infobubble_inner").html(o).css({width:h.w?h.w+"px":"",height:h.h?h.h+"px":""}),S(".infobubble").attr("class","infobubble"+(h.class?" "+h.class:"")),S(".infobubble .close").remove(),S(".infobubble").prepend('<button class="close button" title="Close constituency information">&times;</button>'),S(".infobubble .close").on("click",{me:this},function(t){t.data.me.closeActive()}),"function"==typeof h.callback&&h.callback.call(this,t,e,i,s),this}return e&&(S(".infobubble").remove(),S("#"+this.id).after('<div class="infobubble generalelection"><div class="infobubble_inner"><div class="spinner"><svg width="64" height="64" viewBox="-32 -32 64 64" xmlns="http://www.w3.org/2000/svg" style="transform-origin: center center;"><style>#odilogo-starburst rect2 { transform-origin: center center; -webkit-transform-origin: center center; }</style><g id="odilogo-starburst"><rect width="4" height="25" x="-2" transform="rotate(7)" fill="#2254F4"><animate attributeName="height" begin="0s" dur="4s" values="25;19;23;29;26;25;31;21;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(27)" fill="#F9BC26"><animate attributeName="height" begin="0s" dur="2s" values="25;29;23;20;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(47)" fill="#00B6FF"><animate attributeName="height" begin="0s" dur="1s" values="25;20;27;25;" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(67)" fill="#D60303"><animate attributeName="height" begin="0s" dur="5s" values="25;15;27;25;32;16;24;27;18;32;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(87)" fill="#722EA5"><animate attributeName="height" begin="0s" dur="6s" values="25;19;26;30;21;24;29;27;15;23;20;29;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(107)" fill="#1DD3A7"><animate attributeName="height" begin="0s" dur="3s" values="25;27;24;32;23;19;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(127)" fill="#EF3AAB"><animate attributeName="height" begin="0s" dur="2s" values="25;20;22;32;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(147)" fill="#FF6700"><animate attributeName="height" begin="0s" dur="4s" values="25;24;18;23;27;23;29;21;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(167)" fill="#0DBC37"><animate attributeName="height" begin="0s" dur="4s" values="25;15;27;25;24;32;16;24;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(187)" fill="#178CFF"><animate attributeName="height" begin="0s" dur="5s" values="25;18;23;21;31;20;24;21;28;31;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(207)" fill="#722EA5"><animate attributeName="height" begin="0s" dur="3s" values="25;32;16;24;19;27;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(227)" fill="#D73058"><animate attributeName="height" begin="0s" dur="5s" values="25;23;25;28;18;27;24;30;31;28;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(247)" fill="#00B6FF"><animate attributeName="height" begin="0s" dur="4s" values="25;19;23;29;26;25;31;21;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(267)" fill="#67E767"><animate attributeName="height" begin="0s" dur="2s" values="25;29;23;20;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(287)" fill="#E6007C"><animate attributeName="height" begin="0s" dur="1s" values="25;20;27;25;" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(307)" fill="#0DBC37"><animate attributeName="height" begin="0s" dur="5s" values="25;15;27;25;32;16;24;27;18;32;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(327)" fill="#D60303"><animate attributeName="height" begin="0s" dur="6s" values="25;19;26;30;21;24;29;27;15;23;20;29;25" calcMode="linear" repeatCount="indefinite" /></rect><rect width="4" height="25" x="-2" transform="rotate(347)" fill="#08DEF9"><animate attributeName="height" begin="0s" dur="3s" values="25;27;24;32;23;19;25" calcMode="linear" repeatCount="indefinite" /></rect></g><g id="odilogo"><circle cx="-12.8" cy="0" r="6.4" style="fill:black;"></circle><path d="M-7 -6.4 l 6.4 0 c 0 0 6.4 0 6.4 6.4 c 0 6.4 -6.4 6.4 -6.4 6.4 L -7 6.4Z" style="fill:black;"></path><rect width="6.4" height="12.5" x="5.5" y="-6.25" style="fill:black;"></rect></g></svg></div></div></div>')),l.file?(console.info("Loading data for "+t,l.file.replace(/%region%/g,t)),S().ajax(l.file.replace(/%region%/g,t),{this:this,callback:r,dataType:0<l.file.indexOf(".json")?"json":"text",region:t,cache:"boolean"!=typeof l.live||!l.live,render:l.render,title:s,success:function(t,e){"text"==e.dataType&&(t=CSV2JSON(t)),this.positionBubble(),"function"==typeof e.callback&&e.callback.call(this,e.title,e.region,t,e)},error:function(t,e){console.error("Unable to load "+e.url),"function"==typeof e.callback&&e.callback.call(this,e.title,e.region)}})):r.call(this,s,t),S("body").addClass("modal"),this},S(".view-toggle").on("change",{me:this},function(t){t.data.me.setType(document.querySelector('input[name="view"]:checked').id,!0)}),S(document).on("keypress",function(t){}),this.loadResults=function(t,e){return t=t||"GE2015-results",this.data||(this.data={}),this.data[t]={},this.hex.data||(this.hex.data={}),this.hex.data[t]={},this.views[t]&&(console.info("Getting "+this.views[t].file),S().ajax(this.views[t].file,{this:this,callback:e,dataType:0<this.views[t].file.indexOf(".json")?"json":"text",type:t,cache:"boolean"!=typeof this.views[t].live||!this.views[t].live,process:this.views[t].process,success:function(t,e){"text"==e.dataType&&(t=CSV2JSON(t)),e.timestamp=getTimestamp(e.header),e.process.call(this,e.type,t,e),"function"==typeof e.callback&&e.callback.call(this,e.type)},error:function(t,e){console.error("Unable to load "+e.url),e.timestamp="12:00",e.process.call(this,e.type,[],e),"function"==typeof e.callback&&e.callback.call(this,e.type)}})),this},this.setColours=function(t){if(t=t||"",0<S("#data-selector").length&&(S("#data-selector")[0].value=t),0<S(".view-toggle").length)for(var e=S(".view-toggle"),i=0;i<e.length;i++)e[i].getAttribute("id")==t&&(e[i].checked=!0);this.by=t;var s="";return this.views[t]&&"function"==typeof this.views[t].key&&(s=this.views[t].key.call(this)),S("#key").html(s),this.hex.updateColours(),this.hex.selected&&this.label(this.hex.selected),this},this}!function(t){var f={};function e(n){for(var t in this.stuquery="1.0.25",this.getBy=function(t,e){var i,s,r;i=-1;var h=[];if(0<e.indexOf(":eq")&&(e=(s=e.replace(/(.*)\:eq\(([0-9]+)\)/,"$1 $2").split(" "))[0],i=parseInt(s[1])),(n=(n="."==e[0]?t.getElementsByClassName(e.substr(1)):"#"==e[0]?t.getElementById(e.substr(1)):t.getElementsByTagName(e))||[]).nodeName&&"SELECT"==n.nodeName)h.push(n);else{for("number"!=typeof n.length&&(n=[n]),r=0;r<n.length;r++)h.push(n[r]);0<=i&&0<h.length&&(h=i<h.length?[h[i]]:[])}return h},this.matchSelector=function(t,e){if("."==e[0]){e=e.substr(1);for(var i=0;i<t.classList.length;i++)if(t.classList[i]==e)return!0}else if("#"==e[0]){if(t.id==e.substr(1))return!0}else if(t.tagName==e.toUpperCase())return!0;return!1},"string"==typeof n?this.e=this.querySelector(document,n):"object"==typeof n&&(this.e="number"==typeof n.length?n:[n]),this.e)this.e[t]&&(this[t]=this.e[t]);return this.length=this.e?this.e.length:0,this}function s(t,e){if(t&&0<t.length)for(var i=0;i<t.length;i++)if(t[i].node==e)return{success:!0,match:i};return{success:!1}}function d(t){if(f[t.type]){var e=s(f[t.type],t.currentTarget);if(e.success)return e.match.data&&(t.data=f[t.type][e.match].data),{fn:f[t.type][e.match].fn,data:t}}return function(){return{fn:""}}}function i(t,e,i,s){for(var r=[],h=0;h<t.length;h++){r.push(t[h].getAttribute(e));var n=!1;for(var a in s)typeof i===s[a]&&(n=!0);n&&(i?t[h].setAttribute(e,i):t[h].removeAttribute(e))}return 1==r.length&&(r=r[0]),void 0===i?r:t}e.prototype.querySelector=function(t,e){var i,s,r,h,n,a,o=[];if(0<=e.indexOf(":eq"))for(i=e.split(" "),r=0;r<i.length;r++)if(0==r)a=this.getBy(t,i[r]);else{for(s=[],h=0;h<a.length;h++)s=s.concat(this.getBy(a[h],i[r]));a=s.splice(0)}else a=t.querySelectorAll(e);for(n=0;n<a.length;n++)o.push(a[n]);return o},e.prototype.ready=function(t){/in/.test(document.readyState)?setTimeout("S(document).ready("+t+")",9):t()},e.prototype.html=function(t){if("number"==typeof t&&(t=""+t),"string"!=typeof t&&1==this.length)return this[0].innerHTML;if("string"==typeof t)for(var e=0;e<this.length;e++)this[e].innerHTML=t;return this},e.prototype.append=function(t){if(!t&&1==this.length)return this[0].innerHTML;if(t)for(var e=0;e<this.length;e++){var i=document.createElement("template");i.innerHTML=t;var s=void 0===i.content?i:i.content;if(0<s.childNodes.length)for(;0<s.childNodes.length;)this[e].appendChild(s.childNodes[0]);else this[e].append(t)}return this},e.prototype.prepend=function(t){var e,i,s,r;if(!t&&1==this.length)return this[0].innerHTML;for(e=0;e<this.length;e++)for((s=document.createElement("div")).innerHTML=t,i=(r=s.childNodes).length-1;0<=i;i--)this[e].insertBefore(r[i],this[e].firstChild);return this},e.prototype.before=function(t){var e,i,s,r;for(e=0;e<this.length;e++)for((i=document.createElement("div")).innerHTML=t,s=i.childNodes,r=0;r<s.length;r++)this[e].parentNode.insertBefore(s[r],this[e]);return this},e.prototype.after=function(t){for(var e=0;e<this.length;e++)this[e].insertAdjacentHTML("afterend",t);return this},e.prototype.off=function(t){"function"!=typeof Element.prototype.removeEventListener&&(Element.prototype.removeEventListener=function(t,e){if(oListeners.hasOwnProperty(t)){for(var i=oListeners[t],s=-1,r=0;r<i.aEls.length;r++)if(i.aEls[r]===this){s=r;break}if(-1!==s)for(var h=0,n=i.aEvts[s];h<n.length;h++)n[h]===e&&n.splice(h,1)}});for(var e=0;e<this.length;e++){var i=s(f[t],this.e[e]);i.success&&(this[e].removeEventListener(t,f[t][i.match].fn2,!1),f[t].splice(i.match,1))}return this},e.prototype.on=function(i,s,t){var e,r,h,n,a,o=(i||window.event).split(/ /);if("function"!=typeof s||t||(t=s,s=""),"function"!=typeof t)return this;if(0<this.length)for(var l,p=this,c=0;c<o.length;c++){i=o[c],l=function(t){var e=d({currentTarget:this,type:i,data:s,originalEvent:t,preventDefault:function(){t.preventDefault&&t.preventDefault()},stopPropagation:function(){t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0)}});if("function"==typeof e.fn)return e.fn.call(p,e.data)};for(var u=0;u<this.length;u++)e=this[u],h=t,n=l,a=s,f[r=i]||(f[r]=[]),f[r].push({node:e,fn:h,fn2:n,data:a}),this[u].addEventListener?this[u].addEventListener(i,l,!1):this[u].attachEvent&&this[u].attachEvent(i,l)}return this},e.prototype.trigger=function(t){for(var e,i=t.split(/ /),s=0;s<i.length;s++){document.createEvent?(e=document.createEvent("HTMLEvents")).initEvent(i[s],!0,!0):(e=document.createEventObject()).eventType=i[s],e.eventName=t;for(var r=0;r<this.length;r++)document.createEvent?this[r].dispatchEvent(e):this[r].fireEvent("on"+e.eventType,e)}return this},e.prototype.focus=function(){return 1==this.length&&this[0].focus(),this},e.prototype.blur=function(){return 1==this.length&&this[0].blur(),this},e.prototype.remove=function(){if(this.length<1)return this;for(var t=this.length-1;0<=t;t--){if(!this[t])return;"function"==typeof this[t].remove?this[t].remove():"function"==typeof this[t].parentElement.removeChild&&this[t].parentElement.removeChild(this[t])}return this},e.prototype.hasClass=function(t){for(var e=!0,i=0;i<this.length;i++)this[i].className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))||(e=!1);return e},e.prototype.toggleClass=function(t){for(var e=0;e<this.length;e++)this[e].className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))?this[e].className=this[e].className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)","g")," ").replace(/ $/,""):this[e].className=(this[e].className+" "+t).replace(/^ /,"");return this},e.prototype.addClass=function(t){for(var e=0;e<this.length;e++)this[e].className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))||(this[e].className=(this[e].className+" "+t).replace(/^ /,""));return this},e.prototype.removeClass=function(t){for(var e=0;e<this.length;e++)for(;this[e].className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"));)this[e].className=this[e].className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)","g")," ").replace(/ $/,"").replace(/^ /,"");return this},e.prototype.css=function(t){var e,i,s;if(1==this.length&&"string"==typeof t)return(e=window.getComputedStyle(this[0]))[t];for(i=0;i<this.length;i++){if(e={},this[i].getAttribute("style"))for(var r=this[i].getAttribute("style").split(";"),h=0;h<r.length;h++){var n=r[h].split(":");2==n.length&&(e[n[0]]=n[1])}if("object"==typeof t){for(s in t)void 0!==t[s]&&(e[s]=t[s]);var a="";for(s in e)void 0!==e[s]&&(a&&(a+=";"),e[s]&&(a+=s+":"+e[s]));this[i].setAttribute("style",a)}}return this},e.prototype.parent=function(){for(var t=[],e=0;e<this.length;e++)t.push(this[e].parentElement);return S(t)},e.prototype.children=function(t){var e;if("string"==typeof t){var i=[];for(e=0;e<this.length;e++)for(var s=0;s<this[e].children.length;s++)this.matchSelector(this[e].children[s],t)&&i.push(this[e].children[s]);return S(i)}for(e=0;e<this.length;e++)this[e]=this[e].children.length>t?this[e].children[t]:this[e];return this},e.prototype.find=function(t){for(var e=[],i=0;i<this.length;i++)e=e.concat(this.querySelector(this[i],t));return S(e)},e.prototype.attr=function(t,e){return i(this,t,e,["string","number"])},e.prototype.prop=function(t,e){return i(this,t,e,["boolean"])},e.prototype.clone=function(){var t=document.createElement("div");return t.appendChild(this[0].cloneNode(!0)),t.innerHTML},e.prototype.replaceWith=function(t){for(var e,i=S(this.e),s=0;s<this.length;s++)(e=document.createElement("div")).innerHTML=t,i[s]=e.cloneNode(!0),this[s].parentNode.replaceChild(i[s],this[s]);return i},e.prototype.width=function(){if(!(1<this.length))return this[0].offsetWidth},e.prototype.height=function(){if(!(1<this.length))return this[0].offsetHeight},e.prototype.outerWidth=function(){if(!(1<this.length)){var t=getComputedStyle(this[0]);return this[0].offsetWidth+parseInt(t.marginLeft)+parseInt(t.marginRight)}},e.prototype.outerHeight=function(){if(!(1<this.length)){var t=getComputedStyle(this[0]);return this[0].offsetHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)}},e.prototype.offset=function(){var t=this[0].getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}},e.prototype.position=function(){if(!(1<this.length))return{left:this[0].offsetLeft,top:this[0].offsetTop}},e.prototype.ajax=function(t,s){if("string"!=typeof t)return!1;s=s||{};var r,e,h="",i="";if(0<t.indexOf("?")&&(e=t.split("?")).length&&(t=e[0],i=e[1]),"jsonp"==s.dataType&&(h="fn_"+(new Date).getTime(),window[h]=function(t){"function"==typeof s.success&&s.success.call(s.this?s.this:this,t,s)}),"boolean"!=typeof s.cache||s.cache||(i+=(i?"&":"")+(new Date).valueOf()),h&&(i+=(i?"&":"")+"callback="+h),s.data&&(i+=(i?"&":"")+s.data),"POST"==s.method?s.url=t:s.url=t+(i?"?"+i:""),"jsonp"==s.dataType){var n=document.createElement("script");return n.src=s.url,document.body.appendChild(n),this}(r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).addEventListener("load",window[h]||function(t){var e;if(s.header=r.getAllResponseHeaders(),200==r.status||201==r.status||202==r.status){if(e=r.response,""!=r.responseType&&"text"!=r.responseType||(e=r.responseText),"json"==s.dataType)try{"string"==typeof e&&(e=JSON.parse(e.replace(/[\n\r]/g,"\\n").replace(/^([^\(]+)\((.*)\)([^\)]*)$/,function(t,e,i,s){return e==h?i:""}).replace(/\\n/g,"\n")))}catch(t){o(t)}if("script"==s.dataType){var i=document.createElement("script");i.setAttribute("type","text/javascript"),i.innerHTML=e,document.head.appendChild(i)}s.statusText="success","function"==typeof s.success&&s.success.call(s.this?s.this:this,e,s)}else s.statusText="error",o(t);"function"==typeof s.complete&&s.complete.call(s.this?s.this:this,e,s)}),r.addEventListener("error",o),r.addEventListener("progress",function(t){"function"==typeof s.progress&&s.progress.call(s.this?s.this:this,t,s)});var a="responseType"in r;function o(t){"function"==typeof s.error&&s.error.call(s.this?s.this:this,t,s)}if(s.beforeSend&&(r=s.beforeSend.call(s.this?s.this:this,r,s)),a&&s.dataType)try{r.responseType=s.dataType}catch(t){o(t)}try{r.open(s.method||"GET",s.url,!0)}catch(t){o(t)}"POST"==s.method&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded");try{r.send("POST"==s.method?i:null)}catch(t){o(t)}return this},e.prototype.loadJSON=function(t,e,i){return(i=i||{}).dataType="json",i.complete=e,this.ajax(t,i),this},t.stuQuery=e,t.S=function(t){return new e(t)}}(window||this),SVG.prototype.clear=function(){return this.nodes=[],this.clippaths=[],this.patterns=[],this.draw(),this},SVG.prototype.draw=function(t){var e,i,s,r="<desc>Created by stuQuery SVG</desc>";if(0<this.patterns.length)for(e=0;e<this.patterns.length;e++)r+=this.patterns[e];if(0<this.clippaths.length){for(r+="<defs>",e=0;e<this.clippaths.length;e++){if(r+='<clipPath id="'+this.clippaths[e].id+'">',this.clippaths[e].type){for(i in this.clippaths[e].update(),r+="<"+this.clippaths[e].type,this.clippaths[e])"type"!=i&&"object"!=typeof this.clippaths[e][i]&&"function"!=typeof this.clippaths[e][i]&&"attributes"!=i&&(r+=" "+i+'="'+this.clippaths[e][i]+'"');r+=" />"}r+="</clipPath>"}r+="</defs>"}function h(t,e){var i,s,r=t[e],h="",n=r.type,a=r.text?r.text.split(/\n/):[];if(r.type){for(i in h+="<"+n,r.update(),r)"type"!=i&&"object"!=typeof r[i]&&"function"!=typeof r[i]&&"attributes"!=i&&("text"==i&&1<a.length?h+="":h+=" "+i+'="'+r[i]+'"');for(s in h+=' id="'+r.id+'"',r.attributes)r.attributes[s]&&(h+=" "+s+'="'+("clip-path"==s?"url(#":"")+r.attributes[s]+("clip-path"==s?")":"")+'"');if(r.text){h+=">";var o=.5*a.length-.5;for(s=0;s<a.length;s++,1.2)h+="<tspan"+(0==s?' dy="-'+1.2*o+'em"':' x="'+(r.attributes.x||r.x)+'" dy="1.2em"')+">"+a[s]+"</tspan>";h+="</"+n+">"}else h+=" />"}return h}for(e=0;e<this.nodes.length;e++)r+=h(this.nodes,e);for(this.paper.html(r),e=0;e<this.nodes.length;e++)if(this.nodes[e].events)for(s=0;s<this.nodes[e].events.length;s++)S("#"+this.nodes[e].id).on(this.nodes[e].events[s].type,this.nodes[e].events[s].attr,this.nodes[e].events[s].fn);return this};